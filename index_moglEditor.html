<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/mogl3d_styles.css">
    <!-- <script src="./lib/mogl3dEditor_.js" type="module"></script> -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.159.0/build/three.module.min.js"
            }
        }
    </script>
    <script src="./plugins/mogl3dEditor_UMD.js" type="module"></script>
</head>
<body>

    <div class="content">
    
        <h1>Mogl3D Editor</h1>

        <div id="editor" class="mogl3d"></div>
        <div>
            <h3>Text output:</h3>
            <div id="text-output"></div>
        </div>
        <div>
            <h3>HTML output</h3>
            <pre id="html-output"></pre>
        </div>
    
    </div>
    <script type="module">
        import { ThreeModules } from './plugins/threeModules.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.159.0/examples/jsm/controls/OrbitControls.js';
        import * as THREE from 'three';

        const editorElement = document.getElementById('editor');
        const myEditor = new MOGL3D( editorElement, {
            onChange: function (html) {
                document.getElementById('text-output').innerHTML = html
                document.getElementById('html-output').textContent = html
            },
            plugins: [{
                'threeModules': ThreeModules,
            }],
            on3DLoad: function( obj, num ) {
                    console.log('obj: ', obj);
                    //title값에 맞게끔 3D씬 생성하기
                    let model = obj.clone();
                    const scnContainer = document.querySelector(`#text-output [title="threeSceneNum${num}"]`);
                    console.log('scnContainer: ', scnContainer );
                    if(scnContainer.firstChild) scnContainer.removeChild(scnContainer.firstChild );
                    let editor = document.querySelector('#editor')
                    let scene = new THREE.Scene();
                    let width = editor.clientWidth * .4;
                    let height = editor.clientHeight * .8;
                    const camera = new THREE.PerspectiveCamera( 75, width / height, 0.1, 1000 );
                    camera.position.z = 5;

                    const grid = new THREE.GridHelper(10);
                    scene.add( grid );
                    if( model ) { 
                        scene.add( model ) 
                    } else {
                        const geometry = new THREE.BoxGeometry( 1, 1, 1 ); 
                        const material = new THREE.MeshBasicMaterial( {color: 0x00ff00} ); 
                        const cube = new THREE.Mesh( geometry, material ); 
                        scene.add( cube );

                    };

                    const light = new THREE.PointLight(0xffffff, 50)
                    light.position.set(0.8, 1.4, 1.0)
                    scene.add(light);

                    const ambientLight = new THREE.AmbientLight()
                    scene.add(ambientLight)

                    let renderer = new THREE.WebGLRenderer();
                    renderer.setSize( width, height );
                    scnContainer.appendChild( renderer.domElement );

                    const controls = new OrbitControls( camera, renderer.domElement);
                    controls.enableDamping = true;

                    function animate() {
                        requestAnimationFrame(animate);
                        controls.update()
                        renderer.render(scene, camera);
                    }

                    animate();

                }
            });    
    
        
    </script>
    
    <!-- <script type="module">
        window.mogl3d.init({

            element: document.getElementById('editor'),
            defaultParagraphSeparator: 'div',

            onChange: function (html) {
                document.getElementById('text-output').innerHTML = html
                document.getElementById('html-output').textContent = html
            }


        })
    </script> -->
</body>
</html>