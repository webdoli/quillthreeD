<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/mogl3d_styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <!-- <script src="./lib/mogl3dEditor_.js" type="module"></script> -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.159.0/build/three.module.min.js"
            }
        }
    </script>
    <script src="./plugins/mogl3dEditor_UMD.js" type="module"></script>
</head>
<body>

    <div class="content">
    
        <h1>Mogl3D Editor</h1>

        <div id="editor" class="mogl3d"></div>
        <div>
            <h3>Text output: <button id='publish-button'>Publish</button></h3>

            <div id="text-output"></div>
        </div>
        <div>
            <h3>HTML output</h3>
            <pre id="html-output"></pre>
        </div>
    
    </div>
    <script type="module">
        import { ThreeModules } from './plugins/threeModules.js';
        import { OrbitControls } from 'https://unpkg.com/three@0.159.0/examples/jsm/controls/OrbitControls.js';
        import * as THREE from 'three';

        const editorElement = document.getElementById('editor');
        const myEditor = new MOGL3D( editorElement, {
            onChange: function ( html, models ) {
                
                // let textOutput = document.getElementById('text-output');
                // let htmlOutput = document.getElementById('html-output')
                // textOutput.innerHTML = html
                // htmlOutput.textContent = html

                // if( models.length > 0 ) {
                //     models.map( model => {
                //         for( let item in model ) {
                //             let node = textOutput.querySelector(`[title="${item}"]`);
                //             let obj = model[item];
                //             let cloneObj = obj.clone();
                //             console.log('node: ', node );
                //             let threeModules = new ThreeModules({
                //                 editor: document.querySelector('#editor')
                //             });
                //             threeModules.init( node, cloneObj );
                //         }
                //     })
                // }

            },
            plugins: [{
                'threeModules': ThreeModules,
            }],
            on3DLoad: function( obj, num ) {
                    // console.log('obj: ', obj);
                }
            });    
    
            const textOutputArea = document.querySelector('#text-output'); 
            const publishBtn = document.querySelector('#publish-button');
            const mogl3dContent = document.querySelector('.mogl3d-content');

            publishBtn.addEventListener('click', e => {

                let models = myEditor.getModels();
                
                textOutputArea.innerHTML = mogl3dContent.innerHTML;
                
                models.map( model => {

                    for( let item in model ) {

                        let node = textOutputArea.querySelector(`[title="${item}"]`);
                        if( node.firstChild ) node.removeChild( node.firstChild );

                        let obj = model[item].clone();
                        let threeModules = new ThreeModules({
                                editor: document.querySelector('#editor')
                            });

                        threeModules.init( node, obj );
                    }
                })
            });

            // 전체화면 Evt
            // document.addEventListener('fullscreenchange', () => {

            // const fullscreenBtns = document.querySelectorAll('.three-scene button');

            //     fullscreenBtns.forEach(btn => {
            //         if (document.fullscreenElement) {
            //            btn.innerText = 'Ave';
            //         } else {
            //            btn.innerText = 'Full';
            //         }
            //     });
            // });

    </script>

</body>
</html>